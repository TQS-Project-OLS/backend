<!DOCTYPE html>
<html>
<head>
    <title>Book Music Sheet</title>
</head>
<body>
    <h1>Book Music Sheet</h1>

    <form id="bookingForm">
        <div>
            <label for="sheetId">Sheet ID:</label>
            <input type="number" id="sheetId" name="sheetId" required>
        </div>

        <div>
            <label for="renterId">Renter ID:</label>
            <input type="number" id="renterId" name="renterId" required>
        </div>

        <div>
            <label for="startDate">Start Date:</label>
            <input type="date" id="startDate" name="startDate" required>
        </div>

        <div>
            <label for="endDate">End Date:</label>
            <input type="date" id="endDate" name="endDate" required>
        </div>

        <button type="submit">Book Sheet</button>
    </form>

    <div id="message"></div>

    <hr>

    <h2>My Bookings</h2>
    <div>
        <label for="searchRenterId">Renter ID:</label>
        <input type="number" id="searchRenterId">
        <button onclick="loadBookings()">Load Bookings</button>
    </div>

    <div id="bookingsList"></div>

    <script>
        document.getElementById('bookingForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const formData = {
                sheetId: parseInt(document.getElementById('sheetId').value),
                renterId: parseInt(document.getElementById('renterId').value),
                startDate: document.getElementById('startDate').value,
                endDate: document.getElementById('endDate').value
            };

            try {
                const response = await fetch('/api/sheets/bookings', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();

                if (response.ok) {
                    document.getElementById('message').innerHTML = '<p>Booking created successfully! Booking ID: ' + data.id + '</p>';
                    document.getElementById('bookingForm').reset();
                } else {
                    document.getElementById('message').innerHTML = '<p>Error: ' + data.error + '</p>';
                }
            } catch (error) {
                document.getElementById('message').innerHTML = '<p>Error: ' + error.message + '</p>';
            }
        });

        async function loadBookings() {
            const renterId = document.getElementById('searchRenterId').value;

            if (!renterId) {
                alert('Please enter a Renter ID');
                return;
            }

            try {
                const response = await fetch('/api/sheets/bookings/renter/' + renterId);
                const bookings = await response.json();

                let html = '<table border="1"><tr><th>Booking ID</th><th>Sheet ID</th><th>Start Date</th><th>End Date</th><th>Status</th></tr>';

                bookings.forEach(booking => {
                    html += '<tr>';
                    html += '<td>' + booking.id + '</td>';
                    html += '<td>' + booking.musicSheet.id + '</td>';
                    html += '<td>' + booking.startDate + '</td>';
                    html += '<td>' + booking.endDate + '</td>';
                    html += '<td>' + booking.status + '</td>';
                    html += '</tr>';
                });

                html += '</table>';
                document.getElementById('bookingsList').innerHTML = html;
            } catch (error) {
                document.getElementById('bookingsList').innerHTML = '<p>Error: ' + error.message + '</p>';
            }
        }
    </script>
</body>
</html>

